global
        maxconn         <%= node["haproxy"]["maxconn"] %>
        nbproc          1
        user            haproxy
        group           haproxy
        stats socket    /var/run/haproxy.sock
        chroot          /home/haproxy

defaults
        mode            http
        retries         3
        option          httplog
        option          httpclose
        option          abortonclose
        timeout connect <%= node["haproxy"]["connect_timeout"] %>
        timeout client  <%= node["haproxy"]["client_timeout"] %>
        timeout server  <%= node["haproxy"]["server_timeout"] %>

<% if node["haproxy"]["enable_admin"] -%>
listen admin 0.0.0.0:22002
  mode            http
  stats           enable
  stats uri       <%= node["haproxy"]["stats_uri"] %>
  stats auth      <%= node["haproxy"]["stats_auth"] %>
  stats refresh   3s
<% end -%>

listen application 0.0.0.0:<%= node["haproxy"]["incoming_port"] %>
  balance <%= node["haproxy"]["balance_algorithm"] %>
  server localhost 127.0.0.1:<%= node["haproxy"]["member_port"] %> weight <%= node["haproxy"]["member_weight"] %> maxconn <%= node["haproxy"]["member_max_connections"] %> check inter <%= node["haproxy"]["member_check_inter"] %> fall <%= node["haproxy"]["member_fall"] %> rise <%= node["haproxy"]["member_rise"] %>
